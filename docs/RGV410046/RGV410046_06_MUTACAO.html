<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.223">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Aulas - 6. Mutação</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../RGV410046/RGV410046_07_RESUMO.html" rel="next">
<link href="../RGV410046/RGV410046_05_SELECAO.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean"
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>


<link rel="stylesheet" href="../style.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Aulas</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../00_about.html"><i class="bi bi-fa fa-home" role="img">
</i> 
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../FIT5306/FIT5306_00_ABOUT.html">
 <span class="menu-text">Bioestatística</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../RGV410046/RGV410046_00_ABOUT.html" aria-current="page">
 <span class="menu-text">Introdução ao R</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.researchgate.net/profile/Tiago_Olivoto"><i class="bi bi-fab fa-researchgate fa" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TiagoOlivoto/classes"><i class="bi bi-bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/tolivoto"><i class="bi bi-bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.mendeley.com/profiles/tiago-olivoto/"><i class="bi bi-fab fa-mendeley fa" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">6. Mutação</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RGV410046/RGV410046_00_ABOUT.html" class="sidebar-item-text sidebar-link">RGV410046 - Introdução à linguagem R de programação</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RGV410046/RGV410046_01_INTRO.html" class="sidebar-item-text sidebar-link">1. O software R</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RGV410046/RGV410046_02_PROGRAMACAO.html" class="sidebar-item-text sidebar-link">2. Introdução à programação R</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RGV410046/RGV410046_03_DADOS.html" class="sidebar-item-text sidebar-link">3. Dados</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RGV410046/RGV410046_04_MANIPULACAO.html" class="sidebar-item-text sidebar-link">4. Manipulação de Dados</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RGV410046/RGV410046_05_SELECAO.html" class="sidebar-item-text sidebar-link">5. Seleção e filtragem</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RGV410046/RGV410046_06_MUTACAO.html" class="sidebar-item-text sidebar-link active">6. Mutação</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RGV410046/RGV410046_07_RESUMO.html" class="sidebar-item-text sidebar-link">7. Sintetização</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Nesta página</h2>
   
  <ul>
  <li><a href="#diretório" id="toc-diretório" class="nav-link active" data-scroll-target="#diretório">Diretório</a></li>
  <li><a href="#pacotes-e-dados" id="toc-pacotes-e-dados" class="nav-link" data-scroll-target="#pacotes-e-dados">Pacotes e dados</a></li>
  <li><a href="#mutação" id="toc-mutação" class="nav-link" data-scroll-target="#mutação">Mutação</a>
  <ul>
  <li><a href="#geral" id="toc-geral" class="nav-link" data-scroll-target="#geral">Geral</a></li>
  <li><a href="#mutação-por-grupos" id="toc-mutação-por-grupos" class="nav-link" data-scroll-target="#mutação-por-grupos">Mutação por grupos</a></li>
  <li><a href="#mutação-de-várias-variáveis" id="toc-mutação-de-várias-variáveis" class="nav-link" data-scroll-target="#mutação-de-várias-variáveis">Mutação de várias variáveis</a></li>
  <li><a href="#mutação-condicional" id="toc-mutação-condicional" class="nav-link" data-scroll-target="#mutação-condicional">Mutação condicional</a>
  <ul class="collapse">
  <li><a href="#ifelse-com-r-base" id="toc-ifelse-com-r-base" class="nav-link" data-scroll-target="#ifelse-com-r-base">ifelse() com R base</a></li>
  <li><a href="#case_when-com-dplyr" id="toc-case_when-com-dplyr" class="nav-link" data-scroll-target="#case_when-com-dplyr">case_when() com dplyr</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/TiagoOlivoto/classes/edit/main/RGV410046/RGV410046_06_MUTACAO.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/TiagoOlivoto/classes/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">6. Mutação</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="diretório" class="level1">
<h1>Diretório</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># meu computador (mudar de acordo)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"E:/Desktop/UFSC/aulas/classes/RGV410046/data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pacotes-e-dados" class="level1">
<h1>Pacotes e dados</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(metan)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># dados</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>maize <span class="ot">&lt;-</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">import</span>(<span class="st">"examples_data.xlsx"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">sheet =</span> <span class="st">"maize"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">setclass =</span> <span class="st">"tbl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mutação" class="level1">
<h1>Mutação</h1>
<section id="geral" class="level2">
<h2 class="anchored" data-anchor-id="geral">Geral</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/mutate.png" class="img-fluid figure-img" alt="Fonte: https://dplyr.tidyverse.org/index.html"></p>
<p></p><figcaption class="figure-caption">Fonte: https://dplyr.tidyverse.org/index.html</figcaption><p></p>
</figure>
</div>
<p>A função <a href="https://dplyr.tidyverse.org/reference/mutate.html"><code>mutate()</code></a> é utilizada quando se deseja adicionar novas variáveis no conjunto de dados. Estas variáveis são funções de variáveis existentes. Como exemplo, vamos criar uma nova variável chamada <code>CD</code> no conjunto de dados <code>maize</code>, qual será a razão entre <code>CESP</code> e <code>DIES</code>. Note que a função adiciona a nova variável após a última variável origina e mantém todas as demais. Você pode controlar a posição da nova variável criada utilizando os argumentos <code>.before</code> e <code>.after</code> (assim como na função <code>relocate()</code>) e quais variáveis são mantidas utilizando o argumento <code>.keep</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># padrão: nova variável inserida na última posição</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CD =</span> CESP<span class="sc">/</span>DIES)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 780 × 11
   AMB   HIB   REP   APLA_PLANT AIES_PLANT  CESP  DIES  MGRA   MMG  NGRA     CD
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 A1    H1    I           2.45       2.39  16.9  52.1 228.   375.    NA  0.324
 2 A1    H1    I           2.5        1.43  14.4  50.7 187.   437.   427  0.284
 3 A1    H1    I           2.69       1.52  16.5  54.7 230.   464.   497  0.302
 4 A1    H1    I           2.8        1.64  16.8  52.0 213.   408.   523  0.323
 5 A1    H1    I           2.62       1.55  15.9  51.6 224.   406.   551  0.308
 6 A1    H1    II          2.12       1.8   15    51.4 203.   383.   529  0.292
 7 A1    H1    II          3.15       1.78  10.9  NA    75.2  256.   294 NA    
 8 A1    H1    II          2.97       1.84  15    53.4 204.   387.   528  0.281
 9 A1    H1    II          3.1        1.78  13.6  50.8 187.   348.   538  0.267
10 A1    H1    II          3.02       1.6   16.3  53.9 250.   430.   582  0.302
# … with 770 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># posição da nova variável</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CD =</span> CESP<span class="sc">/</span>DIES, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.after =</span> DIES)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 780 × 11
   AMB   HIB   REP   APLA_PLANT AIES_PLANT  CESP  DIES     CD  MGRA   MMG  NGRA
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 A1    H1    I           2.45       2.39  16.9  52.1  0.324 228.   375.    NA
 2 A1    H1    I           2.5        1.43  14.4  50.7  0.284 187.   437.   427
 3 A1    H1    I           2.69       1.52  16.5  54.7  0.302 230.   464.   497
 4 A1    H1    I           2.8        1.64  16.8  52.0  0.323 213.   408.   523
 5 A1    H1    I           2.62       1.55  15.9  51.6  0.308 224.   406.   551
 6 A1    H1    II          2.12       1.8   15    51.4  0.292 203.   383.   529
 7 A1    H1    II          3.15       1.78  10.9  NA   NA      75.2  256.   294
 8 A1    H1    II          2.97       1.84  15    53.4  0.281 204.   387.   528
 9 A1    H1    II          3.1        1.78  13.6  50.8  0.267 187.   348.   538
10 A1    H1    II          3.02       1.6   16.3  53.9  0.302 250.   430.   582
# … with 770 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mantém somente as utilizadas no cálculo</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CD =</span> CESP<span class="sc">/</span>DIES,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.keep =</span> <span class="st">"used"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 780 × 3
    CESP  DIES     CD
   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1  16.9  52.1  0.324
 2  14.4  50.7  0.284
 3  16.5  54.7  0.302
 4  16.8  52.0  0.323
 5  15.9  51.6  0.308
 6  15    51.4  0.292
 7  10.9  NA   NA    
 8  15    53.4  0.281
 9  13.6  50.8  0.267
10  16.3  53.9  0.302
# … with 770 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mantém as não utilizadas</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CD =</span> CESP<span class="sc">/</span>DIES,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.keep =</span> <span class="st">"unused"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 780 × 9
   AMB   HIB   REP   APLA_PLANT AIES_PLANT  MGRA   MMG  NGRA     CD
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 A1    H1    I           2.45       2.39 228.   375.    NA  0.324
 2 A1    H1    I           2.5        1.43 187.   437.   427  0.284
 3 A1    H1    I           2.69       1.52 230.   464.   497  0.302
 4 A1    H1    I           2.8        1.64 213.   408.   523  0.323
 5 A1    H1    I           2.62       1.55 224.   406.   551  0.308
 6 A1    H1    II          2.12       1.8  203.   383.   529  0.292
 7 A1    H1    II          3.15       1.78  75.2  256.   294 NA    
 8 A1    H1    II          2.97       1.84 204.   387.   528  0.281
 9 A1    H1    II          3.1        1.78 187.   348.   538  0.267
10 A1    H1    II          3.02       1.6  250.   430.   582  0.302
# … with 770 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mantém somente a variável criada</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CD =</span> CESP<span class="sc">/</span>DIES,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.keep =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 780 × 1
       CD
    &lt;dbl&gt;
 1  0.324
 2  0.284
 3  0.302
 4  0.323
 5  0.308
 6  0.292
 7 NA    
 8  0.281
 9  0.267
10  0.302
# … with 770 more rows</code></pre>
</div>
</div>
</section>
<section id="mutação-por-grupos" class="level2">
<h2 class="anchored" data-anchor-id="mutação-por-grupos">Mutação por grupos</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://dplyr.tidyverse.org/index.html"><img src="figs/group_by.png" class="img-fluid figure-img" alt="Fonte: https://dplyr.tidyverse.org/index.html"></a></p>
</figure>
</div>
<p>A função <code>group_by()</code> pode ser utilizada para realizar mutação dentro de cada nível de uma ou mais variáveis categóricas. Para este exemplo, vamos criar uma variável (rank) que será o rankeamento das observações dentro de cada híbrido com base na MGRA (em ordem decrescente).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(HIB) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(<span class="fu">desc</span>(MGRA)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 780 × 11
# Groups:   HIB [13]
   AMB   HIB   REP   APLA_PLANT AIES_PLANT  CESP  DIES  MGRA   MMG  NGRA  rank
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 A1    H1    I           2.45       2.39  16.9  52.1 228.   375.    NA     8
 2 A1    H1    I           2.5        1.43  14.4  50.7 187.   437.   427    33
 3 A1    H1    I           2.69       1.52  16.5  54.7 230.   464.   497     7
 4 A1    H1    I           2.8        1.64  16.8  52.0 213.   408.   523    15
 5 A1    H1    I           2.62       1.55  15.9  51.6 224.   406.   551     9
 6 A1    H1    II          2.12       1.8   15    51.4 203.   383.   529    22
 7 A1    H1    II          3.15       1.78  10.9  NA    75.2  256.   294    60
 8 A1    H1    II          2.97       1.84  15    53.4 204.   387.   528    21
 9 A1    H1    II          3.1        1.78  13.6  50.8 187.   348.   538    31
10 A1    H1    II          3.02       1.6   16.3  53.9 250.   430.   582     5
# … with 770 more rows</code></pre>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>O ranqueamento acima foi obtido com base no ranqueamento, utilizando a função <code>slice_min()</code>. Execute o código abaixo e veja o que acontece.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(HIB) <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(MGRA, <span class="at">n =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Em alguns casos, um agrupamento específico onde cada linha é considerada um grupo pode ser útil. Isto pode ser realizado com a função <code>rowwise()</code>. Como <code>group_by()</code>, <code>rowwise()</code> não faz nada sozinha; apenas muda a forma como os outros verbos (ex., mutate, summarise funcionam). Por exemplo, compare os resultados de mutate() no código a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">y =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">z =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sem rowise()</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">m =</span> <span class="fu">sum</span>(<span class="fu">c</span>(x, y, z)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
      x     y     z     m
  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1     1     3     5    21
2     2     4     6    21</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># com rowise()</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">soma =</span> <span class="fu">sum</span>(<span class="fu">c</span>(x, y, z)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
# Rowwise: 
      x     y     z  soma
  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1     1     3     5     9
2     2     4     6    12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mesmo resultado</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># utilizando semântica tidyselect </span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">soma =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(x<span class="sc">:</span>z)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
# Rowwise: 
      x     y     z  soma
  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1     1     3     5     9
2     2     4     6    12</code></pre>
</div>
</div>
</section>
<section id="mutação-de-várias-variáveis" class="level2">
<h2 class="anchored" data-anchor-id="mutação-de-várias-variáveis">Mutação de várias variáveis</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/across.png" class="img-fluid figure-img" alt="Fonte: https://dplyr.tidyverse.org/reference/across.html"></p>
<p></p><figcaption class="figure-caption">Fonte: https://dplyr.tidyverse.org/reference/across.html</figcaption><p></p>
</figure>
</div>
<p>Em alguns casos, deseja-se aplicar a mesma função de mutação (ou resumo) à várias variáveis. A função <a href="https://dplyr.tidyverse.org/reference/across.html"><code>across()</code></a> facilita a aplicação da mesma transformação a várias colunas, permitindo que você use a semântica <code>select()</code> dentro de funções como <code>summarise()</code> e <code>mutate()</code>. Como exemplo de aplicação, vamos criar uma função para rescalar uma variável para uma amplitude 0-1 e aplicar essa função à todas as colunas numéricas do conjunto <code>maize</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># função para rescalar</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>rescale <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  rng <span class="ot">&lt;-</span> <span class="fu">range</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> rng[<span class="dv">1</span>]) <span class="sc">/</span> (rng[<span class="dv">2</span>] <span class="sc">-</span> rng[<span class="dv">1</span>])</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># aplica a função rescale() a todas as colunas numéricas</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), rescale))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 780 × 10
   AMB   HIB   REP   APLA_PLANT AIES_PLANT  CESP   DIES   MGRA   MMG   NGRA
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 A1    H1    I          0.742      1     0.821  0.674 0.730  0.596 NA    
 2 A1    H1    I          0.758      0.492 0.694  0.611 0.551  0.742  0.370
 3 A1    H1    I          0.815      0.540 0.801  0.786 0.739  0.805  0.463
 4 A1    H1    I          0.848      0.603 0.816  0.670 0.666  0.674  0.497
 5 A1    H1    I          0.794      0.556 0.770  0.652 0.710  0.669  0.534
 6 A1    H1    II         0.642      0.688 0.724  0.645 0.620  0.615  0.505
 7 A1    H1    II         0.955      0.677 0.515 NA     0.0717 0.314  0.194
 8 A1    H1    II         0.9        0.709 0.724  0.728 0.627  0.624  0.504
 9 A1    H1    II         0.939      0.677 0.653  0.620 0.553  0.532  0.517
10 A1    H1    II         0.915      0.582 0.791  0.752 0.825  0.726  0.575
# … with 770 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aplica a função rescale() para algumas colunas</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(MGRA<span class="sc">:</span>NGRA, rescale))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 780 × 10
   AMB   HIB   REP   APLA_PLANT AIES_PLANT  CESP  DIES   MGRA   MMG   NGRA
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 A1    H1    I           2.45       2.39  16.9  52.1 0.730  0.596 NA    
 2 A1    H1    I           2.5        1.43  14.4  50.7 0.551  0.742  0.370
 3 A1    H1    I           2.69       1.52  16.5  54.7 0.739  0.805  0.463
 4 A1    H1    I           2.8        1.64  16.8  52.0 0.666  0.674  0.497
 5 A1    H1    I           2.62       1.55  15.9  51.6 0.710  0.669  0.534
 6 A1    H1    II          2.12       1.8   15    51.4 0.620  0.615  0.505
 7 A1    H1    II          3.15       1.78  10.9  NA   0.0717 0.314  0.194
 8 A1    H1    II          2.97       1.84  15    53.4 0.627  0.624  0.504
 9 A1    H1    II          3.1        1.78  13.6  50.8 0.553  0.532  0.517
10 A1    H1    II          3.02       1.6   16.3  53.9 0.825  0.726  0.575
# … with 770 more rows</code></pre>
</div>
</div>
<p>Também é possível utilizar a semântica <code>select()</code> dentro de <code>across()</code>. Isso significa que <em>select helpers</em> podem ser utilizados. No exemplo abaixo apenas as variáveis que contém <code>"_PLANT"</code> são mutadas, sendo que os valores destas variáveis são divididos por 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># usando select helpers</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># divide o valor da variável pela metade</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># atribui um sufixo para as novas variáveis</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># seleciona apenas as utilizadas</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"_PLANT"</span>), <span class="sc">~</span>.x <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">"{.col}_metade"</span>),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">.after =</span> AIES_PLANT,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">.keep =</span> <span class="st">"used"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 780 × 4
   APLA_PLANT AIES_PLANT APLA_PLANT_metade AIES_PLANT_metade
        &lt;dbl&gt;      &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;
 1       2.45       2.39              1.23             1.20 
 2       2.5        1.43              1.25             0.715
 3       2.69       1.52              1.34             0.76 
 4       2.8        1.64              1.4              0.82 
 5       2.62       1.55              1.31             0.775
 6       2.12       1.8               1.06             0.9  
 7       3.15       1.78              1.58             0.89 
 8       2.97       1.84              1.48             0.92 
 9       3.1        1.78              1.55             0.89 
10       3.02       1.6               1.51             0.8  
# … with 770 more rows</code></pre>
</div>
</div>
</section>
<section id="mutação-condicional" class="level2">
<h2 class="anchored" data-anchor-id="mutação-condicional">Mutação condicional</h2>
<p>É muito comum comum que condicionantes sejam necessárias quando alguma nova variável for criada. Abaixo, um pequeno exemplo contendo notas de 10 alunos é utilizado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>notas <span class="ot">&lt;-</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">aluno =</span> <span class="fu">paste0</span>(<span class="st">"Aluno"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">nota =</span> <span class="fu">runif</span>(<span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">10</span>) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">1</span>))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>notas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     aluno nota
1   Aluno1  4.4
2   Aluno2  7.8
3   Aluno3  9.4
4   Aluno4  5.0
5   Aluno5  3.7
6   Aluno6  7.9
7   Aluno7  6.7
8   Aluno8  8.7
9   Aluno9  9.7
10 Aluno10  3.8</code></pre>
</div>
</div>
<p>Os objetivos aqui são:</p>
<ol type="1">
<li>Criar uma nova variável em <code>notas</code> contendo a classe que tal aluno foi classificado dependendo de sua nota, com as seguintes condições:
<ul>
<li>Nota menor que 4: <strong>reprovado</strong></li>
<li>Nota de 4 a menos que 7: <strong>exame</strong></li>
<li>Nota igual ou maior que 7: <strong>aprovado</strong></li>
</ul></li>
<li>Ordenar as notas em ordem decrescente (do maior para o menor).</li>
</ol>
<section id="ifelse-com-r-base" class="level3">
<h3 class="anchored" data-anchor-id="ifelse-com-r-base">ifelse() com R base</h3>
<p>A função <code>ifelse()</code> retorna um valor com a mesma forma de <code>test</code> que é preenchido com elementos selecionados de <code>yes</code> ou <code>no</code>, dependendo se o elemento de <code>test</code> é <code>TRUE</code> ou <code>FALSE</code>. Para criação da nova coluna baseado nas notas em <code>notas</code>, utiliza-se a seguinte abordagem. Note que como temos três classes (aprovado, reprovado ou exame) e <code>ifelse()</code> somente retorna duas dependendo se o teste é <code>TRUE</code> ou <code>FALSE</code>, precisamos aninhar <code>ifelse()</code>s.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>classe <span class="ot">&lt;-</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(notas,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">condicao =</span> <span class="fu">ifelse</span>(nota <span class="sc">&lt;</span> <span class="dv">4</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">yes =</span> <span class="st">"reprovado"</span>, </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">no =</span> <span class="fu">ifelse</span>(nota <span class="sc">&gt;=</span> <span class="dv">4</span> <span class="sc">&amp;</span> nota <span class="sc">&lt;</span> <span class="dv">7</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">yes =</span> <span class="st">"exame"</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">no =</span> <span class="st">"aprovado"</span>)))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>classe[<span class="fu">order</span>(classe<span class="sc">$</span>nota, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     aluno nota  condicao
9   Aluno9  9.7  aprovado
3   Aluno3  9.4  aprovado
8   Aluno8  8.7  aprovado
6   Aluno6  7.9  aprovado
2   Aluno2  7.8  aprovado
7   Aluno7  6.7     exame
4   Aluno4  5.0     exame
1   Aluno1  4.4     exame
10 Aluno10  3.8 reprovado
5   Aluno5  3.7 reprovado</code></pre>
</div>
</div>
</section>
<section id="case_when-com-dplyr" class="level3">
<h3 class="anchored" data-anchor-id="case_when-com-dplyr">case_when() com dplyr</h3>
<p><code>case_when()</code> pode ser vista como uma versão vetorizada de <code>ifelse()</code> que permite que você avalie várias instruções. Se nenhum caso corresponder, <code>NA</code> será retornado. Esta função é particularmente útil dentro da função <code>mutate()</code> quando você quer criar uma nova variável que depende de uma combinação complexa de variáveis existentes.</p>
<p>A função é baseada em uma sequência de fórmulas de dois lados. O lado esquerdo (LHS) determina o teste; O lado direito (RHS) fornece o valor de substituição.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>notas <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">condicao =</span> <span class="fu">case_when</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    nota <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"reprovado"</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">between</span>(nota, <span class="dv">4</span>, <span class="fl">6.99999999</span>) <span class="sc">~</span> <span class="st">"exame"</span>, <span class="co"># mesmo que nota &gt;= 4 &amp; nota &lt; 7</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"aprovado"</span> <span class="co"># TRUE: o que não foi incluso nas duas avaliações anteriores</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(nota))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     aluno nota  condicao
1   Aluno9  9.7  aprovado
2   Aluno3  9.4  aprovado
3   Aluno8  8.7  aprovado
4   Aluno6  7.9  aprovado
5   Aluno2  7.8  aprovado
6   Aluno7  6.7     exame
7   Aluno4  5.0     exame
8   Aluno1  4.4     exame
9  Aluno10  3.8 reprovado
10  Aluno5  3.7 reprovado</code></pre>
</div>
</div>
<p>Neste exemplo, o conjunto de dados <code>maize</code> é utilizado para mostrar como uma variável qualitativa nominal pode ser criada utilizando a função <code>case_when()</code>. A nova variável será criada dependendo dos valores de <code>APLA</code>, <code>AIES</code> ou <code>CESP</code>. Ao agrupar pela nova variável categórica criada e utilizar a função <code>slice_sample()</code>, um exemplo de cada nível é amostrado aleatoriamente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">CASO =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>      MGRA <span class="sc">&gt;</span> <span class="dv">280</span> <span class="sc">|</span> APLA_PLANT <span class="sc">&lt;</span> <span class="fl">1.3</span> <span class="sc">|</span> NGRA <span class="sc">&gt;</span> <span class="dv">820</span> <span class="sc">~</span>  <span class="st">"Selecionar"</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      APLA_PLANT <span class="sc">&gt;</span> <span class="fl">2.3</span> <span class="sc">~</span> <span class="st">"Alto"</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>      MGRA <span class="sc">&lt;</span> <span class="dv">130</span> <span class="sc">~</span> <span class="st">"Pouco produtivo"</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Outro"</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CASO) <span class="sc">|&gt;</span> </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 11
# Groups:   CASO [4]
  AMB   HIB   REP   APLA_PLANT AIES_PLANT  CESP  DIES  MGRA   MMG  NGRA CASO    
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
1 A1    H10   III         3.11       1.86  15.5  50.2 194.   405.   479 Alto    
2 A3    H2    II          2.04       0.92  14.7  47.2 130.   362.   360 Outro   
3 A3    H9    I           2.24       1.17  13    42.6  92.6  384.   241 Pouco p…
4 A3    H2    III         0          1.25  17.8  51.6 196.   348.   562 Selecio…</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Abordagem R base
</div>
</div>
<div class="callout-body-container callout-body">
<p>O seguinte exemplo realiza o mesmo procedimento de criação da variável categórica utilizando as funções R base <code>transform()</code> e <code>ifelse()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>milho2 <span class="ot">&lt;-</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">transform</span>(maize, </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">CASO =</span> <span class="fu">ifelse</span>(MGRA <span class="sc">&gt;</span> <span class="dv">280</span> <span class="sc">|</span> APLA_PLANT <span class="sc">&lt;</span> <span class="fl">1.3</span> <span class="sc">|</span> NGRA <span class="sc">&gt;</span> <span class="dv">820</span>, <span class="st">"Selecionar"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(APLA_PLANT <span class="sc">&gt;</span> <span class="fl">2.3</span>, <span class="st">"Alto"</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">ifelse</span>(MGRA <span class="sc">&lt;</span> <span class="dv">130</span>, <span class="st">"Pouco produtivo"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Outro"</span>))))</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># cria uma lista onde cada elemento é um nível de CASO</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>casos <span class="ot">&lt;-</span> <span class="fu">split</span>(milho2, milho2<span class="sc">$</span>CASO)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co"># percorre a lista e amostra uma linha aleatória de cada uma</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># junta com rbind()</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(rbind,</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(casos, <span class="cf">function</span>(x){</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    x[<span class="fu">sample</span>(<span class="fu">nrow</span>(x), <span class="dv">1</span>), ]</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                AMB HIB REP APLA_PLANT AIES_PLANT CESP  DIES      MGRA      MMG
Alto             A1 H10 III       3.01       1.64 17.0 54.27 210.78954 419.0647
Outro            A3  H3   I       2.28       1.19 14.3 51.62 162.09701 305.2674
Pouco produtivo  A3  H9  II       1.80       0.58 12.4 42.47  73.97816 271.9785
Selecionar       A3  H2 III       0.00       1.25 17.8 51.57 195.59343 348.0310
                NGRA            CASO
Alto             503            Alto
Outro            531           Outro
Pouco produtivo  272 Pouco produtivo
Selecionar       562      Selecionar</code></pre>
</div>
</div>
</div>
</div>
<div align="center"><a href="https://www.free-website-hit-counter.com"><img src="https://www.free-website-hit-counter.com/c.php?d=9&amp;id=138588&amp;s=2" border="0" alt="Free Website Hit Counter"></a><br><small><a href="https://www.free-website-hit-counter.com" title="Free Website Hit Counter">Free website hit counter</a></small></div>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../RGV410046/RGV410046_05_SELECAO.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">5. Seleção e filtragem</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../RGV410046/RGV410046_07_RESUMO.html" class="pagination-link">
        <span class="nav-page-text">7. Sintetização</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb38" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "6. Mutação"</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu"># Diretório</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include = FALSE}</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_knit<span class="sc">$</span><span class="fu">set</span>(<span class="at">root.dir =</span> <span class="st">"E:/Desktop/UFSC/aulas/classes/RGV410046/data"</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># meu computador (mudar de acordo)</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"E:/Desktop/UFSC/aulas/classes/RGV410046/data"</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="fu"># Pacotes e dados</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE, message=FALSE}</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(metan)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="co"># dados</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>maize <span class="ot">&lt;-</span> </span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">import</span>(<span class="st">"examples_data.xlsx"</span>,</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">sheet =</span> <span class="st">"maize"</span>,</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">setclass =</span> <span class="st">"tbl"</span>)</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="fu"># Mutação</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="fu">## Geral</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="al">![Fonte: https://dplyr.tidyverse.org/index.html](figs/mutate.png)</span>{alt="Fonte: https://dplyr.tidyverse.org/index.html"}</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>A função <span class="co">[</span><span class="ot">`mutate()`</span><span class="co">](https://dplyr.tidyverse.org/reference/mutate.html)</span> é utilizada quando se deseja adicionar novas variáveis no conjunto de dados. Estas variáveis são funções de variáveis existentes. Como exemplo, vamos criar uma nova variável chamada <span class="in">`CD`</span> no conjunto de dados <span class="in">`maize`</span>, qual será a razão entre <span class="in">`CESP`</span> e <span class="in">`DIES`</span>. Note que a função adiciona a nova variável após a última variável origina e mantém todas as demais. Você pode controlar a posição da nova variável criada utilizando os argumentos <span class="in">`.before`</span> e <span class="in">`.after`</span> (assim como na função <span class="in">`relocate()`</span>) e quais variáveis são mantidas utilizando o argumento <span class="in">`.keep`</span>.</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="co"># padrão: nova variável inserida na última posição</span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CD =</span> CESP<span class="sc">/</span>DIES)</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a><span class="co"># posição da nova variável</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CD =</span> CESP<span class="sc">/</span>DIES, </span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.after =</span> DIES)</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a><span class="co"># mantém somente as utilizadas no cálculo</span></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CD =</span> CESP<span class="sc">/</span>DIES,</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.keep =</span> <span class="st">"used"</span>)</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a><span class="co"># mantém as não utilizadas</span></span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CD =</span> CESP<span class="sc">/</span>DIES,</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.keep =</span> <span class="st">"unused"</span>)</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a><span class="co"># mantém somente a variável criada</span></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CD =</span> CESP<span class="sc">/</span>DIES,</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.keep =</span> <span class="st">"none"</span>)</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mutação por grupos</span></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="al">![](figs/group_by.png)</span><span class="ot">{fig-alt="Fonte: https://dplyr.tidyverse.org/index.html"}</span><span class="co">](https://dplyr.tidyverse.org/index.html)</span></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>A função <span class="in">`group_by()`</span> pode ser utilizada para realizar mutação dentro de cada nível de uma ou mais variáveis categóricas. Para este exemplo, vamos criar uma variável (rank) que será o rankeamento das observações dentro de cada híbrido com base na MGRA (em ordem decrescente).</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">|&gt;</span> </span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(HIB) <span class="sc">|&gt;</span> </span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(<span class="fu">desc</span>(MGRA)))</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a>O ranqueamento acima foi obtido com base no ranqueamento, utilizando a função <span class="in">`slice_min()`</span>. Execute o código abaixo e veja o que acontece.</span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">|&gt;</span> </span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(HIB) <span class="sc">|&gt;</span> </span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(MGRA, <span class="at">n =</span> <span class="dv">2</span>)</span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a>Em alguns casos, um agrupamento específico onde cada linha é considerada um grupo pode ser útil. Isto pode ser realizado com a função <span class="in">`rowwise()`</span>. Como <span class="in">`group_by()`</span>, <span class="in">`rowwise()`</span> não faz nada sozinha; apenas muda a forma como os outros verbos (ex., mutate, summarise funcionam). Por exemplo, compare os resultados de mutate() no código a seguir:</span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">y =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">z =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a><span class="co"># sem rowise()</span></span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">m =</span> <span class="fu">sum</span>(<span class="fu">c</span>(x, y, z)))</span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a><span class="co"># com rowise()</span></span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">soma =</span> <span class="fu">sum</span>(<span class="fu">c</span>(x, y, z)))</span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a><span class="co"># mesmo resultado</span></span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a><span class="co"># utilizando semântica tidyselect </span></span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">soma =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(x<span class="sc">:</span>z)))</span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mutação de várias variáveis</span></span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a><span class="al">![Fonte: https://dplyr.tidyverse.org/reference/across.html](figs/across.png)</span>{alt="Fonte: https://dplyr.tidyverse.org/reference/across.html"}</span>
<span id="cb38-108"><a href="#cb38-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-109"><a href="#cb38-109" aria-hidden="true" tabindex="-1"></a>Em alguns casos, deseja-se aplicar a mesma função de mutação (ou resumo) à várias variáveis. A função <span class="co">[</span><span class="ot">`across()`</span><span class="co">](https://dplyr.tidyverse.org/reference/across.html)</span> facilita a aplicação da mesma transformação a várias colunas, permitindo que você use a semântica <span class="in">`select()`</span> dentro de funções como <span class="in">`summarise()`</span> e <span class="in">`mutate()`</span>. Como exemplo de aplicação, vamos criar uma função para rescalar uma variável para uma amplitude 0-1 e aplicar essa função à todas as colunas numéricas do conjunto <span class="in">`maize`</span>.</span>
<span id="cb38-110"><a href="#cb38-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-113"><a href="#cb38-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-114"><a href="#cb38-114" aria-hidden="true" tabindex="-1"></a><span class="co"># função para rescalar</span></span>
<span id="cb38-115"><a href="#cb38-115" aria-hidden="true" tabindex="-1"></a>rescale <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb38-116"><a href="#cb38-116" aria-hidden="true" tabindex="-1"></a>  rng <span class="ot">&lt;-</span> <span class="fu">range</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-117"><a href="#cb38-117" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> rng[<span class="dv">1</span>]) <span class="sc">/</span> (rng[<span class="dv">2</span>] <span class="sc">-</span> rng[<span class="dv">1</span>])</span>
<span id="cb38-118"><a href="#cb38-118" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-119"><a href="#cb38-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-120"><a href="#cb38-120" aria-hidden="true" tabindex="-1"></a><span class="co"># aplica a função rescale() a todas as colunas numéricas</span></span>
<span id="cb38-121"><a href="#cb38-121" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), rescale))</span>
<span id="cb38-122"><a href="#cb38-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-123"><a href="#cb38-123" aria-hidden="true" tabindex="-1"></a><span class="co"># aplica a função rescale() para algumas colunas</span></span>
<span id="cb38-124"><a href="#cb38-124" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(MGRA<span class="sc">:</span>NGRA, rescale))</span>
<span id="cb38-125"><a href="#cb38-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-126"><a href="#cb38-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-127"><a href="#cb38-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-128"><a href="#cb38-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-129"><a href="#cb38-129" aria-hidden="true" tabindex="-1"></a>Também é possível utilizar a semântica <span class="in">`select()`</span> dentro de <span class="in">`across()`</span>. Isso significa que *select helpers* podem ser utilizados. No exemplo abaixo apenas as variáveis que contém <span class="in">`"_PLANT"`</span> são mutadas, sendo que os valores destas variáveis são divididos por 2.</span>
<span id="cb38-130"><a href="#cb38-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-133"><a href="#cb38-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-134"><a href="#cb38-134" aria-hidden="true" tabindex="-1"></a><span class="co"># usando select helpers</span></span>
<span id="cb38-135"><a href="#cb38-135" aria-hidden="true" tabindex="-1"></a><span class="co"># divide o valor da variável pela metade</span></span>
<span id="cb38-136"><a href="#cb38-136" aria-hidden="true" tabindex="-1"></a><span class="co"># atribui um sufixo para as novas variáveis</span></span>
<span id="cb38-137"><a href="#cb38-137" aria-hidden="true" tabindex="-1"></a><span class="co"># seleciona apenas as utilizadas</span></span>
<span id="cb38-138"><a href="#cb38-138" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span></span>
<span id="cb38-139"><a href="#cb38-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"_PLANT"</span>), <span class="sc">~</span>.x <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb38-140"><a href="#cb38-140" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">"{.col}_metade"</span>),</span>
<span id="cb38-141"><a href="#cb38-141" aria-hidden="true" tabindex="-1"></a>         <span class="at">.after =</span> AIES_PLANT,</span>
<span id="cb38-142"><a href="#cb38-142" aria-hidden="true" tabindex="-1"></a>         <span class="at">.keep =</span> <span class="st">"used"</span>)</span>
<span id="cb38-143"><a href="#cb38-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-144"><a href="#cb38-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-145"><a href="#cb38-145" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mutação condicional</span></span>
<span id="cb38-146"><a href="#cb38-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-147"><a href="#cb38-147" aria-hidden="true" tabindex="-1"></a>É muito comum comum que condicionantes sejam necessárias quando alguma nova variável for criada. Abaixo, um pequeno exemplo contendo notas de 10 alunos é utilizado.</span>
<span id="cb38-148"><a href="#cb38-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-151"><a href="#cb38-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-152"><a href="#cb38-152" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb38-153"><a href="#cb38-153" aria-hidden="true" tabindex="-1"></a>notas <span class="ot">&lt;-</span> </span>
<span id="cb38-154"><a href="#cb38-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">aluno =</span> <span class="fu">paste0</span>(<span class="st">"Aluno"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb38-155"><a href="#cb38-155" aria-hidden="true" tabindex="-1"></a>             <span class="at">nota =</span> <span class="fu">runif</span>(<span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">10</span>) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">1</span>))</span>
<span id="cb38-156"><a href="#cb38-156" aria-hidden="true" tabindex="-1"></a>notas</span>
<span id="cb38-157"><a href="#cb38-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-158"><a href="#cb38-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-159"><a href="#cb38-159" aria-hidden="true" tabindex="-1"></a>Os objetivos aqui são:</span>
<span id="cb38-160"><a href="#cb38-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-161"><a href="#cb38-161" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Criar uma nova variável em <span class="in">`notas`</span> contendo a classe que tal aluno foi classificado dependendo de sua nota, com as seguintes condições:</span>
<span id="cb38-162"><a href="#cb38-162" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Nota menor que 4: **reprovado**</span>
<span id="cb38-163"><a href="#cb38-163" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Nota de 4 a menos que 7: **exame**</span>
<span id="cb38-164"><a href="#cb38-164" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Nota igual ou maior que 7: **aprovado**</span>
<span id="cb38-165"><a href="#cb38-165" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Ordenar as notas em ordem decrescente (do maior para o menor).</span>
<span id="cb38-166"><a href="#cb38-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-167"><a href="#cb38-167" aria-hidden="true" tabindex="-1"></a><span class="fu">### ifelse() com R base</span></span>
<span id="cb38-168"><a href="#cb38-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-169"><a href="#cb38-169" aria-hidden="true" tabindex="-1"></a>A função <span class="in">`ifelse()`</span> retorna um valor com a mesma forma de <span class="in">`test`</span> que é preenchido com elementos selecionados de <span class="in">`yes`</span> ou <span class="in">`no`</span>, dependendo se o elemento de <span class="in">`test`</span> é <span class="in">`TRUE`</span> ou <span class="in">`FALSE`</span>. Para criação da nova coluna baseado nas notas em <span class="in">`notas`</span>, utiliza-se a seguinte abordagem. Note que como temos três classes (aprovado, reprovado ou exame) e <span class="in">`ifelse()`</span> somente retorna duas dependendo se o teste é <span class="in">`TRUE`</span> ou <span class="in">`FALSE`</span>, precisamos aninhar <span class="in">`ifelse()`</span>s.</span>
<span id="cb38-170"><a href="#cb38-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-173"><a href="#cb38-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-174"><a href="#cb38-174" aria-hidden="true" tabindex="-1"></a>classe <span class="ot">&lt;-</span> </span>
<span id="cb38-175"><a href="#cb38-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(notas,</span>
<span id="cb38-176"><a href="#cb38-176" aria-hidden="true" tabindex="-1"></a>            <span class="at">condicao =</span> <span class="fu">ifelse</span>(nota <span class="sc">&lt;</span> <span class="dv">4</span>,</span>
<span id="cb38-177"><a href="#cb38-177" aria-hidden="true" tabindex="-1"></a>                           <span class="at">yes =</span> <span class="st">"reprovado"</span>, </span>
<span id="cb38-178"><a href="#cb38-178" aria-hidden="true" tabindex="-1"></a>                           <span class="at">no =</span> <span class="fu">ifelse</span>(nota <span class="sc">&gt;=</span> <span class="dv">4</span> <span class="sc">&amp;</span> nota <span class="sc">&lt;</span> <span class="dv">7</span>,</span>
<span id="cb38-179"><a href="#cb38-179" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">yes =</span> <span class="st">"exame"</span>,</span>
<span id="cb38-180"><a href="#cb38-180" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">no =</span> <span class="st">"aprovado"</span>)))</span>
<span id="cb38-181"><a href="#cb38-181" aria-hidden="true" tabindex="-1"></a>classe[<span class="fu">order</span>(classe<span class="sc">$</span>nota, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb38-182"><a href="#cb38-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-183"><a href="#cb38-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-184"><a href="#cb38-184" aria-hidden="true" tabindex="-1"></a><span class="fu">### case_when() com dplyr</span></span>
<span id="cb38-185"><a href="#cb38-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-186"><a href="#cb38-186" aria-hidden="true" tabindex="-1"></a><span class="in">`case_when()`</span> pode ser vista como uma versão vetorizada de <span class="in">`ifelse()`</span> que permite que você avalie várias instruções. Se nenhum caso corresponder, <span class="in">`NA`</span> será retornado. Esta função é particularmente útil dentro da função <span class="in">`mutate()`</span> quando você quer criar uma nova variável que depende de uma combinação complexa de variáveis existentes.</span>
<span id="cb38-187"><a href="#cb38-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-188"><a href="#cb38-188" aria-hidden="true" tabindex="-1"></a>A função é baseada em uma sequência de fórmulas de dois lados. O lado esquerdo (LHS) determina o teste; O lado direito (RHS) fornece o valor de substituição.</span>
<span id="cb38-189"><a href="#cb38-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-192"><a href="#cb38-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-193"><a href="#cb38-193" aria-hidden="true" tabindex="-1"></a>notas <span class="sc">|&gt;</span> </span>
<span id="cb38-194"><a href="#cb38-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">condicao =</span> <span class="fu">case_when</span>(</span>
<span id="cb38-195"><a href="#cb38-195" aria-hidden="true" tabindex="-1"></a>    nota <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"reprovado"</span>,</span>
<span id="cb38-196"><a href="#cb38-196" aria-hidden="true" tabindex="-1"></a>    <span class="fu">between</span>(nota, <span class="dv">4</span>, <span class="fl">6.99999999</span>) <span class="sc">~</span> <span class="st">"exame"</span>, <span class="co"># mesmo que nota &gt;= 4 &amp; nota &lt; 7</span></span>
<span id="cb38-197"><a href="#cb38-197" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"aprovado"</span> <span class="co"># TRUE: o que não foi incluso nas duas avaliações anteriores</span></span>
<span id="cb38-198"><a href="#cb38-198" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb38-199"><a href="#cb38-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(nota))</span>
<span id="cb38-200"><a href="#cb38-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-201"><a href="#cb38-201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-202"><a href="#cb38-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-203"><a href="#cb38-203" aria-hidden="true" tabindex="-1"></a>Neste exemplo, o conjunto de dados <span class="in">`maize`</span> é utilizado para mostrar como uma variável qualitativa nominal pode ser criada utilizando a função <span class="in">`case_when()`</span>. A nova variável será criada dependendo dos valores de <span class="in">`APLA`</span>, <span class="in">`AIES`</span> ou <span class="in">`CESP`</span>. Ao agrupar pela nova variável categórica criada e utilizar a função <span class="in">`slice_sample()`</span>, um exemplo de cada nível é amostrado aleatoriamente.</span>
<span id="cb38-204"><a href="#cb38-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-207"><a href="#cb38-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-208"><a href="#cb38-208" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb38-209"><a href="#cb38-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-210"><a href="#cb38-210" aria-hidden="true" tabindex="-1"></a>maize <span class="sc">%&gt;%</span> </span>
<span id="cb38-211"><a href="#cb38-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-212"><a href="#cb38-212" aria-hidden="true" tabindex="-1"></a>    <span class="at">CASO =</span> <span class="fu">case_when</span>(</span>
<span id="cb38-213"><a href="#cb38-213" aria-hidden="true" tabindex="-1"></a>      MGRA <span class="sc">&gt;</span> <span class="dv">280</span> <span class="sc">|</span> APLA_PLANT <span class="sc">&lt;</span> <span class="fl">1.3</span> <span class="sc">|</span> NGRA <span class="sc">&gt;</span> <span class="dv">820</span> <span class="sc">~</span>  <span class="st">"Selecionar"</span>,</span>
<span id="cb38-214"><a href="#cb38-214" aria-hidden="true" tabindex="-1"></a>      APLA_PLANT <span class="sc">&gt;</span> <span class="fl">2.3</span> <span class="sc">~</span> <span class="st">"Alto"</span>,</span>
<span id="cb38-215"><a href="#cb38-215" aria-hidden="true" tabindex="-1"></a>      MGRA <span class="sc">&lt;</span> <span class="dv">130</span> <span class="sc">~</span> <span class="st">"Pouco produtivo"</span>,</span>
<span id="cb38-216"><a href="#cb38-216" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Outro"</span></span>
<span id="cb38-217"><a href="#cb38-217" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-218"><a href="#cb38-218" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb38-219"><a href="#cb38-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CASO) <span class="sc">|&gt;</span> </span>
<span id="cb38-220"><a href="#cb38-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb38-221"><a href="#cb38-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-222"><a href="#cb38-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-223"><a href="#cb38-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-224"><a href="#cb38-224" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb38-225"><a href="#cb38-225" aria-hidden="true" tabindex="-1"></a><span class="fu">## Abordagem R base</span></span>
<span id="cb38-226"><a href="#cb38-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-227"><a href="#cb38-227" aria-hidden="true" tabindex="-1"></a>O seguinte exemplo realiza o mesmo procedimento de criação da variável categórica utilizando as funções R base <span class="in">`transform()`</span> e <span class="in">`ifelse()`</span>.</span>
<span id="cb38-228"><a href="#cb38-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-231"><a href="#cb38-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-232"><a href="#cb38-232" aria-hidden="true" tabindex="-1"></a>milho2 <span class="ot">&lt;-</span> </span>
<span id="cb38-233"><a href="#cb38-233" aria-hidden="true" tabindex="-1"></a><span class="fu">transform</span>(maize, </span>
<span id="cb38-234"><a href="#cb38-234" aria-hidden="true" tabindex="-1"></a>          <span class="at">CASO =</span> <span class="fu">ifelse</span>(MGRA <span class="sc">&gt;</span> <span class="dv">280</span> <span class="sc">|</span> APLA_PLANT <span class="sc">&lt;</span> <span class="fl">1.3</span> <span class="sc">|</span> NGRA <span class="sc">&gt;</span> <span class="dv">820</span>, <span class="st">"Selecionar"</span>,</span>
<span id="cb38-235"><a href="#cb38-235" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(APLA_PLANT <span class="sc">&gt;</span> <span class="fl">2.3</span>, <span class="st">"Alto"</span>,</span>
<span id="cb38-236"><a href="#cb38-236" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">ifelse</span>(MGRA <span class="sc">&lt;</span> <span class="dv">130</span>, <span class="st">"Pouco produtivo"</span>,</span>
<span id="cb38-237"><a href="#cb38-237" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Outro"</span>))))</span>
<span id="cb38-238"><a href="#cb38-238" aria-hidden="true" tabindex="-1"></a><span class="co"># cria uma lista onde cada elemento é um nível de CASO</span></span>
<span id="cb38-239"><a href="#cb38-239" aria-hidden="true" tabindex="-1"></a>casos <span class="ot">&lt;-</span> <span class="fu">split</span>(milho2, milho2<span class="sc">$</span>CASO)</span>
<span id="cb38-240"><a href="#cb38-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-241"><a href="#cb38-241" aria-hidden="true" tabindex="-1"></a><span class="co"># percorre a lista e amostra uma linha aleatória de cada uma</span></span>
<span id="cb38-242"><a href="#cb38-242" aria-hidden="true" tabindex="-1"></a><span class="co"># junta com rbind()</span></span>
<span id="cb38-243"><a href="#cb38-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-244"><a href="#cb38-244" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb38-245"><a href="#cb38-245" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(rbind,</span>
<span id="cb38-246"><a href="#cb38-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(casos, <span class="cf">function</span>(x){</span>
<span id="cb38-247"><a href="#cb38-247" aria-hidden="true" tabindex="-1"></a>    x[<span class="fu">sample</span>(<span class="fu">nrow</span>(x), <span class="dv">1</span>), ]</span>
<span id="cb38-248"><a href="#cb38-248" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb38-249"><a href="#cb38-249" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-250"><a href="#cb38-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-251"><a href="#cb38-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-252"><a href="#cb38-252" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb38-253"><a href="#cb38-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-254"><a href="#cb38-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb38-255"><a href="#cb38-255" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div align='center'&gt;&lt;a href='https://www.free-website-hit-counter.com'&gt;&lt;img src='https://www.free-website-hit-counter.com/c.php?d=9&amp;id=138588&amp;s=2' border='0' alt='Free Website Hit Counter'&gt;&lt;/a&gt;&lt;br / &gt;&lt;small&gt;&lt;a href='https://www.free-website-hit-counter.com' title="Free Website Hit Counter"&gt;Free website hit counter&lt;/a&gt;&lt;/small&gt;&lt;/div&gt;</span></span>
<span id="cb38-256"><a href="#cb38-256" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Material de apoio à disciplinas</div>   
    <div class="nav-footer-right">Prof.&nbsp;Dr.&nbsp;Tiago Olivoto FIT/CCA/UFSC</div>
  </div>
</footer>



<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>